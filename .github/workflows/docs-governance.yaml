# Docs governance checks (blocking).
#
# This workflow enforces design/ADR/interaction-flow governance rules:
# - markdown local link + anchor integrity
# - master-flow traceability manifest coverage + reference validity
# - design doc layering and canonical link constraints
#
# See: docs/design/ci/scripts/check_design_doc_governance.sh

name: Design Docs Governance

on:
  pull_request:
    paths:
      - 'docs/design/**'
      - 'docs/adr/**'
      - 'docs/i18n/**'
  push:
    branches: [main]
    paths:
      - 'docs/design/**'
      - 'docs/adr/**'
      - 'docs/i18n/**'

permissions:
  contents: read

jobs:
  design-docs-governance:
    name: Check Design Docs Governance
    runs-on: ubuntu-24.04
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd  # v6.0.2
        with:
          fetch-depth: 0

      - name: Install ripgrep
        run: sudo apt-get update && sudo apt-get install -y ripgrep

      - name: Setup Go (for markdown link checker)
        uses: actions/setup-go@7a3fe6cf4cb3a834922a1244abfce67bcef6a0c5  # v6.2.0
        with:
          go-version-file: 'go.mod'

      - name: Run governance checks
        run: bash docs/design/ci/scripts/check_design_doc_governance.sh
